# Step 5: Implementation Reference - ecommerce

> Generated by bicep-implement agent | 2025-12-17

## Bicep Templates Location

üìÅ **Code Location**: [`infra/bicep/ecommerce/`](../../infra/bicep/ecommerce/)

## File Structure

```text
infra/bicep/ecommerce/
‚îú‚îÄ‚îÄ main.bicep              # Main orchestration template
‚îú‚îÄ‚îÄ main.bicepparam         # Parameter file
‚îú‚îÄ‚îÄ main.json               # Compiled ARM template
‚îú‚îÄ‚îÄ deploy.ps1              # PowerShell deployment script
‚îú‚îÄ‚îÄ README.md               # Deployment documentation
‚îî‚îÄ‚îÄ modules/
    ‚îú‚îÄ‚îÄ network.bicep       # VNet and subnets
    ‚îú‚îÄ‚îÄ keyvault.bicep      # Key Vault with RBAC
    ‚îú‚îÄ‚îÄ sql.bicep           # SQL Server with Azure AD auth
    ‚îú‚îÄ‚îÄ redis.bicep         # Redis Cache
    ‚îú‚îÄ‚îÄ appservice.bicep    # App Service Plan and Web App
    ‚îú‚îÄ‚îÄ search.bicep        # Cognitive Search
    ‚îú‚îÄ‚îÄ servicebus.bicep    # Service Bus Premium
    ‚îú‚îÄ‚îÄ functions.bicep     # Azure Functions
    ‚îú‚îÄ‚îÄ frontdoor.bicep     # Front Door with WAF
    ‚îî‚îÄ‚îÄ monitoring.bicep    # Log Analytics and App Insights
```

## Validation Status

| Check         | Status  |
| ------------- | ------- |
| `bicep build` | ‚úÖ Pass |
| `bicep lint`  | ‚úÖ Pass |

## Resources Created

| Resource                | Bicep Type                               | Module           |
| ----------------------- | ---------------------------------------- | ---------------- |
| Virtual Network         | Microsoft.Network/virtualNetworks        | network.bicep    |
| Key Vault               | Microsoft.KeyVault/vaults                | keyvault.bicep   |
| SQL Server              | Microsoft.Sql/servers                    | sql.bicep        |
| SQL Database            | Microsoft.Sql/servers/databases          | sql.bicep        |
| Redis Cache             | Microsoft.Cache/redis                    | redis.bicep      |
| App Service Plan        | Microsoft.Web/serverfarms                | appservice.bicep |
| Web App                 | Microsoft.Web/sites                      | appservice.bicep |
| Cognitive Search        | Microsoft.Search/searchServices          | search.bicep     |
| Service Bus Namespace   | Microsoft.ServiceBus/namespaces          | servicebus.bicep |
| Function App            | Microsoft.Web/sites                      | functions.bicep  |
| Front Door              | Microsoft.Cdn/profiles                   | frontdoor.bicep  |
| Log Analytics Workspace | Microsoft.OperationalInsights/workspaces | monitoring.bicep |
| Application Insights    | Microsoft.Insights/components            | monitoring.bicep |

## Deployment Instructions

### Quick Deploy

```powershell
cd infra/bicep/ecommerce
./deploy.ps1 -ResourceGroupName "rg-ecommerce-prod" -Location "swedencentral"
```

### Preview Changes (What-If)

```powershell
./deploy.ps1 -ResourceGroupName "rg-ecommerce-prod" -Location "swedencentral" -WhatIf
```

### Custom Parameters

```powershell
./deploy.ps1 `
  -ResourceGroupName "rg-ecommerce-prod" `
  -Location "swedencentral" `
  -Environment "prod" `
  -SqlAdminGroupId "<azure-ad-group-id>"
```

---

## Key Implementation Notes

- All private endpoints deployed to `snet-data` subnet
- Managed identities used for all service-to-service auth
- Key Vault uses RBAC (not access policies)
- SQL Server configured with Azure AD-only authentication
- Front Door WAF uses OWASP 3.2 rule set

---

_Implementation complete. See [07-design-document.md](07-design-document.md) for full architecture documentation._
