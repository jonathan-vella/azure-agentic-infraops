# Governance Constraints - Agent Testing Framework

> Generated by bicep-plan agent | 2026-01-22

## Azure Policy Compliance

| Category              | Constraint                | Implementation                       |
| --------------------- | ------------------------- | ------------------------------------ |
| Subscription          | noalz                     | 00858ffc-dded-4f0f-8bbf-e17fff0d47d9 |
| Policies Found        | 10 assignments            | All audit/DINE mode                  |
| Blocking Policies     | None                      | No deny policies active              |
| Compliance Initiative | PCI DSS v4, GDPR          | Audit mode only                      |
| Defender              | DataProtection, SQL, RBAC | DeployIfNotExists                    |

---

## Required Tags

All resources must include the following tags:

```bicep
tags: {
  Environment: environment  // dev, staging, prod
  Project: projectName      // agent-testing
  ManagedBy: 'Bicep'
  Owner: owner              // platform-engineering
  TTL: '2h'                 // Cleanup automation
}
```

## Security Policies

| Policy           | Requirement                                              |
| ---------------- | -------------------------------------------------------- |
| HTTPS Only       | Required (PCI DSS audits if false)                       |
| TLS Version      | TLS 1.2 minimum                                          |
| Public Access    | Disabled for storage blob access                         |
| Managed Identity | Preferred for all services                               |
| Key Vault        | RBAC authorization enabled, soft delete disabled (test)  |

## Cost Policies

| Policy            | Constraint                            |
| ----------------- | ------------------------------------- |
| Budget            | ~$50/month for test infrastructure    |
| SKU Restrictions  | Basic/Standard tiers for all services |
| Reserved Capacity | Not applicable (ephemeral resources)  |

## Network Policies

| Policy            | Constraint                          |
| ----------------- | ----------------------------------- |
| Private Endpoints | Optional for SQL Server             |
| VNet Integration  | Not configured (test infrastructure)|
| Public Endpoints  | Allowed for test scenarios          |

---

## Policy Assignments Discovered

### Compliance Initiatives (Audit Mode)

| Policy                                           | Effect | Impact on Test Resources        |
| ------------------------------------------------ | ------ | ------------------------------- |
| **PCI DSS v4**                                   | Audit  | Will report findings, not block |
| **EU General Data Protection Regulation (GDPR)** | Audit  | Will report findings, not block |

### Defender for Cloud Policies (DeployIfNotExists)

| Policy                                          | Effect            | Impact on Test Resources       |
| ----------------------------------------------- | ----------------- | ------------------------------ |
| **ASC DataProtection**                          | DeployIfNotExists | May deploy diagnostic settings |
| **ASC OpenSourceRelationalDatabasesProtection** | DeployIfNotExists | N/A - not using OSS databases  |
| **Defender for SQL Servers on Machines**        | DeployIfNotExists | N/A - not using SQL VMs        |

### Resource Group Scoped Policies (ArcBox)

| Policy                                           | Scope              | Impact on Test Resources |
| ------------------------------------------------ | ------------------ | ------------------------ |
| **Enable Azure Monitor for Hybrid VMs with AMA** | rg-arc-itpro-swc01 | N/A - different RG       |
| **Enable Azure Update Manager (Linux)**          | rg-arc-itpro-swc01 | N/A - different RG       |
| **Enable Azure Update Manager (Windows)**        | rg-arc-itpro-swc01 | N/A - different RG       |

---

## Constraints Applied to Implementation

### Region Constraints

| Constraint      | Value                   | Source          |
| --------------- | ----------------------- | --------------- |
| Primary Region  | swedencentral           | Project default |
| Fallback Region | germanywestcentral      | Project default |
| Restriction     | None enforced by policy | ARG discovery   |

### Tag Requirements

| Tag         | Required | Enforcement   | Value Pattern          |
| ----------- | -------- | ------------- | ---------------------- |
| Environment | âœ… Yes   | CAF default   | `test`                 |
| ManagedBy   | âœ… Yes   | CAF default   | `Bicep`                |
| Project     | âœ… Yes   | CAF default   | `agent-testing`        |
| Owner       | âœ… Yes   | CAF default   | `platform-engineering` |
| TTL         | âœ… Yes   | Cleanup logic | `2h`                   |

> **Note**: No Azure Policy enforces tags on this subscription.
> Tags are applied as CAF best practice for resource organization and cleanup.

### Security Requirements

| Setting              | Value     | Enforcement | Notes                        |
| -------------------- | --------- | ----------- | ---------------------------- |
| HTTPS-only (Storage) | `true`    | Audit       | PCI DSS will audit if false  |
| TLS 1.2+             | `true`    | Audit       | PCI DSS will audit if false  |
| Public blob access   | `false`   | Audit       | PCI DSS will audit if true   |
| SQL TDE              | `enabled` | Audit       | Defender will audit if false |

---

## Impact Assessment

### Blocking Risks

| Risk Level | Description                                                                      |
| ---------- | -------------------------------------------------------------------------------- |
| ðŸŸ¢ **Low** | No blocking policies detected. All policies are audit or DeployIfNotExists mode. |

### Expected Audit Findings

Test resources will generate compliance findings that should be **ignored**:

1. **PCI DSS findings**: Test resources not configured for production security
2. **GDPR findings**: Test resources may lack full encryption configuration
3. **Defender findings**: May auto-deploy diagnostic settings (harmless)

### Recommended Actions

1. **Document expected findings**: Note that test RG findings are expected
2. **Exclude from compliance reports**: Filter `rg-agent-test-*` from compliance dashboards
3. **Apply security defaults anyway**: Follow CAF patterns even if not enforced

---

## Governance Alignment in Implementation

The implementation plan will enforce these settings regardless of policy:

```bicep
// Required on all resources (CAF defaults)
tags: {
  Environment: 'test'
  ManagedBy: 'Bicep'
  Project: 'agent-testing'
  Owner: 'platform-engineering'
  TTL: '2h'
}

// Security defaults (WAF best practices)
properties: {
  supportsHttpsTrafficOnly: true
  minimumTlsVersion: 'TLS1_2'
  allowBlobPublicAccess: false
}
```

---

_Governance constraints discovered via Azure Resource Graph | 2026-01-22_
