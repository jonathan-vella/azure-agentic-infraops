# Step 2: Architecture Assessment - Agent Testing & Validation Framework

> Generated by architect agent | 2026-01-22

## Requirements Validation âœ…

| Category                | Status | Notes                                                       |
| ----------------------- | ------ | ----------------------------------------------------------- |
| **NFRs (SLA/RTO/RPO)**  | âœ…     | SLA 99%, RTO 1 hour, RPO 24 hours â€” appropriate for testing |
| **Compliance**          | âœ…     | None required â€” internal testing framework                  |
| **Budget**              | âœ…     | $50-100/month soft limit for Azure test resources           |
| **Scale Requirements**  | âœ…     | 9â†’15 agents, 5â†’15 scenarios, 1â†’5 concurrent executions      |
| **Performance Targets** | âœ…     | < 30 min full suite, < 5 min per agent, < 60 sec response   |
| **Region Selection**    | âœ…     | Primary: swedencentral, Failover: germanywestcentral        |

**Validation Result**: All critical requirements defined. Proceeding with assessment.

---

## Executive Summary

The **Agent Testing & Validation Framework** is a quality assurance infrastructure designed to
validate the 9 custom GitHub Copilot agents in the Agentic InfraOps workflow. This is a
**developer-facing, ephemeral testing workload** with the following characteristics:

| Aspect               | Characteristic                                        |
| -------------------- | ----------------------------------------------------- |
| **Workload Type**    | Ephemeral test infrastructure (created/destroyed)     |
| **User Base**        | Platform engineering team (1-5 developers)            |
| **Criticality**      | Medium â€” impacts development velocity, not production |
| **Data Sensitivity** | Low â€” synthetic test data, no customer information    |
| **Cost Profile**     | Consumption-based, auto-cleanup after validation      |

### Recommended Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GitHub Actions CI/CD                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Functional   â”‚  â”‚ Integration  â”‚  â”‚ Quality      â”‚  â”‚ Azure        â”‚    â”‚
â”‚  â”‚ Tests        â”‚  â”‚ Tests        â”‚  â”‚ Tests        â”‚  â”‚ Tests        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                      â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Azure Subscription: noalz                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                Ephemeral Test Resource Groups                          â”‚ â”‚
â”‚  â”‚   rg-agent-test-{scenario}-{timestamp}                                 â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚   â”‚ Static Web  â”‚  â”‚ App Service â”‚  â”‚ SQL Databaseâ”‚  â”‚ Key Vault    â”‚ â”‚ â”‚
â”‚  â”‚   â”‚ Apps (Free) â”‚  â”‚ B1 (Test)   â”‚  â”‚ Basic/DTU5  â”‚  â”‚ Standard     â”‚ â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚  â”‚   â”‚ Container   â”‚  â”‚ Service Bus â”‚  â”‚ Storage     â”‚                   â”‚ â”‚
â”‚  â”‚   â”‚ Apps (Cons) â”‚  â”‚ Basic       â”‚  â”‚ LRS         â”‚                   â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚   [ Auto-cleanup after 2 hours via Azure Automation ]                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                Persistent Infrastructure (Optional)                    â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚   â”‚ Azure Automation Account (for cleanup runbooks)                 â”‚ â”‚ â”‚
â”‚  â”‚   â”‚ Log Analytics Workspace (optional - for test metrics)           â”‚ â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Architecture Decisions:**

1. **Ephemeral-first**: Test resources created per-run, destroyed after validation
2. **GitHub Actions as orchestrator**: No dedicated test infrastructure needed
3. **Cheapest viable SKUs**: B1 App Service, Basic SQL, Free Static Web Apps
4. **Auto-cleanup**: Azure Automation runbook ensures no orphaned resources
5. **Golden files in Git**: Version-controlled baselines, no database needed

---

## WAF Pillar Assessment

### Overall Scores

| Pillar                    | Score | Confidence | Summary                                       |
| ------------------------- | ----- | ---------- | --------------------------------------------- |
| ðŸ”’ Security               | 7/10  | High       | Service principals, RBAC, no sensitive data   |
| ðŸ”„ Reliability            | 6/10  | High       | Ephemeral resources, acceptable for testing   |
| âš¡ Performance            | 8/10  | High       | Optimized for fast feedback loops             |
| ðŸ’° Cost Optimization      | 9/10  | High       | Consumption-based, auto-cleanup, minimal SKUs |
| ðŸ”§ Operational Excellence | 8/10  | High       | Fully automated CI/CD, golden file tracking   |

**Primary Pillar Optimized**: ðŸ’° Cost Optimization  
**Trade-offs Accepted**: Lower reliability (ephemeral resources), minimal security layers
(public endpoints acceptable for test resources)

---

### ðŸ”’ Security Assessment (7/10)

**Strengths:**

- Service principal authentication with federated credentials (OIDC)
- Contributor RBAC scoped to test resource groups only
- No customer data or sensitive information in test scenarios
- Azure AD (Entra ID) for all authentication
- Secrets stored in GitHub Actions secrets (not in code)

**Gaps:**

- Public endpoints used for test resources (acceptable for testing)
- No network isolation (VNet/Private Endpoints)
- No Azure Policy enforcement on test resource groups

**Recommendations:**

1. Use federated identity credentials (workload identity federation) for GitHub Actions
2. Create dedicated `rg-agent-test-*` resource groups with auto-delete policy
3. Scope service principal to minimal required permissions:
   - Contributor on test resource groups
   - Reader on subscription (for policy discovery)
4. Rotate service principal credentials annually

### ðŸ”„ Reliability Assessment (6/10)

**Strengths:**

- Git as single source of truth for all test configurations
- Golden files versioned and can be regenerated at any time
- No dependency on persistent test infrastructure
- GitHub Actions provides redundant runners

**Gaps:**

- Test resources are ephemeral â€” no HA or redundancy
- Single region deployment (swedencentral)
- No retry logic for transient Azure API failures

**Recommendations:**

1. Implement retry logic in test scripts (3 retries with exponential backoff)
2. Cache Azure API responses where appropriate (policy discovery)
3. Store test results in GitHub Actions artifacts (30-day retention)
4. Add fallback to `germanywestcentral` if `swedencentral` has issues

### âš¡ Performance Assessment (8/10)

**Strengths:**

- Parallel test execution for independent test categories
- Minimal SKUs reduce deployment time (B1 deploys faster than P1v3)
- Template validation tests run in < 10 seconds
- Full test suite target: < 30 minutes

**Gaps:**

- Sequential agent testing (agents can't run in true parallel)
- Azure deployments add latency (what-if: 30-60 sec, deploy: 2-5 min)
- Cold start on consumption-based services

**Recommendations:**

1. Run functional, integration, and quality tests in parallel jobs
2. Use `bicep build` and `bicep lint` before Azure deployment (fast feedback)
3. Limit full Azure deployment tests to nightly/weekly schedules
4. Cache Bicep modules to speed up builds

### ðŸ’° Cost Assessment (9/10)

| Service             | SKU          | Usage/Month | Unit Cost     | Monthly Cost |
| ------------------- | ------------ | ----------- | ------------- | ------------ |
| Static Web Apps     | Free         | 5 scenarios | $0.00         | **$0.00**    |
| App Service Plan    | B1 Linux     | ~20 hrs     | $0.018/hr     | **$0.36**    |
| Azure SQL Database  | Basic (DTU5) | ~20 hrs     | $0.0068/hr    | **$0.14**    |
| Key Vault           | Standard     | 100 ops     | $0.03/10K ops | **$0.01**    |
| Storage Account     | LRS          | 1 GB        | $0.018/GB     | **$0.02**    |
| Container Apps      | Consumption  | 1 hr        | $0.000004/sec | **$0.01**    |
| Service Bus         | Basic        | 1K messages | $0.05/1M      | **$0.01**    |
| Azure Automation    | Free tier    | 500 min     | $0.00         | **$0.00**    |
| GitHub Actions      | Included     | 2000 min    | $0.00         | **$0.00**    |
| **Total Estimated** |              |             |               | **~$1-5/mo** |

**Budget Status**: âœ… Well under $50-100/month budget

**Cost Optimization Applied:**

- âœ… Free tier for Static Web Apps (sufficient for smoke tests)
- âœ… B1 (Basic) tier for App Service (cheapest compute)
- âœ… Basic DTU for SQL (5 DTU sufficient for testing)
- âœ… Consumption-based Container Apps (pay per request)
- âœ… Auto-cleanup after 2 hours (prevents orphaned resources)
- âœ… GitHub Actions included minutes (2000/month free)
- âœ… No reserved instances (ephemeral workload)

### ðŸ”§ Operational Excellence Assessment (8/10)

**Strengths:**

- Fully automated CI/CD pipeline (GitHub Actions)
- Infrastructure as Code (test scenarios defined in Git)
- Golden file comparison for regression detection
- Template compliance validation extends existing scripts
- Clear test categories with defined pass/fail criteria

**Gaps:**

- No dashboard for test metrics over time (optional)
- Manual golden file approval process
- No automated cost alerting

**Recommendations:**

1. Create GitHub Actions workflow with matrix strategy for test scenarios
2. Implement golden file diff bot for PR comments
3. Add `npm run test:*` scripts for local development
4. Set up Azure Cost Management budget alert at $75/month

---

## Resource SKU Recommendations

| Service            | Recommended SKU | Configuration          | Justification                           |
| ------------------ | --------------- | ---------------------- | --------------------------------------- |
| App Service Plan   | B1 (Linux)      | Auto-delete after test | Cheapest compute, sufficient for tests  |
| Azure SQL Database | Basic (5 DTU)   | Single database        | Minimal cost, adequate for validation   |
| Key Vault          | Standard        | Soft delete disabled   | Low operation count, easy cleanup       |
| Storage Account    | Standard LRS    | Delete after test      | No redundancy needed for test data      |
| Container Apps     | Consumption     | Scale to zero          | Pay only during test execution          |
| Service Bus        | Basic           | 1 namespace per test   | Minimal messaging for integration tests |
| Static Web Apps    | Free            | No custom domain       | Sufficient for smoke tests              |
| Azure Automation   | Free tier       | 500 min/month          | Cleanup runbook execution               |

---

## Architecture Decision Summary

| Decision                    | Choice                   | Rationale                                      |
| --------------------------- | ------------------------ | ---------------------------------------------- |
| **Test Infrastructure**     | Ephemeral (per-run)      | Cost optimization, no maintenance overhead     |
| **Orchestration**           | GitHub Actions           | Native CI/CD, included minutes, OIDC auth      |
| **Baseline Storage**        | Git (golden files)       | Version control, diff tracking, no database    |
| **Azure Region**            | swedencentral            | Matches production defaults, EU data residency |
| **Service Principal Scope** | Test RG Contributor      | Least privilege, scoped to test resources      |
| **Test Result Storage**     | GitHub Actions artifacts | 30-day retention, no additional cost           |
| **Cleanup Mechanism**       | Azure Automation + tags  | Automated 2-hour TTL, prevents cost overrun    |
| **Golden File Approval**    | PR labels + diff bot     | User approval with automation assistance       |

---

## Implementation Handoff

### Ready for bicep-plan

The architecture is approved for implementation with the following key parameters:

```yaml
region: swedencentral
environment: test
subscription: noalz (00858ffc-dded-4f0f-8bbf-e17fff0d47d9)
budget: $50-100/month (estimated: ~$5/month)

resources:
  ephemeral:
    - App Service (B1 Linux) â€” per test run
    - Azure SQL Database (Basic 5 DTU) â€” per test run
    - Key Vault (Standard) â€” per test run
    - Storage Account (LRS) â€” per test run
    - Container Apps (Consumption) â€” per test run
    - Service Bus (Basic) â€” per test run
    - Static Web Apps (Free) â€” per test run
  persistent:
    - Azure Automation Account (cleanup runbooks)
    - Service Principal (federated identity)

security:
  - Workload identity federation (OIDC) for GitHub Actions
  - Contributor RBAC on test resource groups only
  - Reader on subscription for policy discovery
  - Auto-delete after 2 hours (tag-based cleanup)
  - No private endpoints (acceptable for testing)

monitoring:
  - GitHub Actions workflow logs
  - Azure Automation runbook logs
  - Cost Management budget alert at $75/month

naming_convention:
  resource_groups: rg-agent-test-{scenario}-{timestamp}
  resources: {type}-test-{scenario}-{suffix}

tags:
  Environment: test
  ManagedBy: Bicep
  Project: agent-testing
  Owner: platform-engineering
  TTL: 2h
```

---

## Approval Gate

> **ðŸ—ï¸ Architecture Assessment Complete**
>
> | Pillar                    | Score |
> | ------------------------- | ----- |
> | ðŸ”’ Security               | 7/10  |
> | ðŸ”„ Reliability            | 6/10  |
> | âš¡ Performance            | 8/10  |
> | ðŸ’° Cost Optimization      | 9/10  |
> | ðŸ”§ Operational Excellence | 8/10  |
>
> **Estimated Monthly Cost**: ~$1-5/month (well under $50-100 budget)
>
> **Confidence Level**: High (complete requirements, proven patterns, real pricing data)
>
> **Primary Trade-off**: Lower reliability and security complexity in exchange for
> maximum cost optimization â€” appropriate for ephemeral test infrastructure.
>
> Reply **"approve"** to proceed to bicep-plan, or provide feedback for revisions.

---

_Assessment performed using Azure Well-Architected Framework.
Pricing data from Azure Pricing MCP (2026-01-22)._
